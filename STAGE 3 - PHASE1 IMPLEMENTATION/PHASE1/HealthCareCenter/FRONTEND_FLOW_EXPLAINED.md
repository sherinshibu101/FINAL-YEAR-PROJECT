â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                    â•‘
â•‘    HOW FILE ENCRYPTION WORKS IN THE FRONTEND & WHAT YOU'LL SEE     â•‘
â•‘                                                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FRONTEND FLOW (What You'll See in Browser)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

USER INTERFACE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      File Encryption Dashboard                      â”‚
â”‚                                                                     â”‚
â”‚  Logged in as: admin@hospital.com (Admin)                          â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€ Uploaded Files â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â”‚  File Name          Size    Status      Algorithm    Date    â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚ â”‚
â”‚  â”‚  Patient1.txt       2.3 KB  ğŸ”’ Encrypted AES-256-GCM 11-26  â”‚ â”‚
â”‚  â”‚                            [Decrypt] [Download] [Delete]    â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â”‚  sample.txt         1.8 KB  ğŸ”’ Encrypted AES-256-GCM 11-25  â”‚ â”‚
â”‚  â”‚                            [Decrypt] [Download] [Delete]    â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  [+ Upload New File]                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


STEP-BY-STEP: USER CLICKS "DECRYPT" BUTTON
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

STEP 1: Frontend UI Changes
  
  User clicks: [Decrypt] button on "sample.txt"
  
  What happens immediately:
  âœ“ Modal opens with loading spinner
  âœ“ Shows: "Decrypting... Please wait"
  âœ“ Button becomes disabled

STEP 2: Frontend Gets JWT Token

  JavaScript code:
  ```javascript
  const token = localStorage.getItem('authToken')
  ```
  
  What this means:
  âœ“ Frontend retrieves the JWT token saved during login
  âœ“ Token looks like: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

STEP 3: Frontend Sends Request to Backend

  JavaScript code:
  ```javascript
  const response = await fetch('/api/files/decrypt', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({
      fileId: 'sample.txt'
    })
  })
  ```

  What gets sent:
  POST /api/files/decrypt
  Header: Authorization: Bearer eyJhbGciOiJIUzI1NiIs...
  Body: { "fileId": "sample.txt" }

STEP 4: Backend Processes Request

  Backend receives request:
  âœ“ Validates JWT (checks if token is valid)
  âœ“ Calls encryption service with user info
  âœ“ Encryption service verifies with IAM (port 4000)

STEP 5: IAM Service Verifies User

  IAM service (port 4000):
  âœ“ Calls /api/me with JWT
  âœ“ Returns: { "id": "1", "name": "Dr. Sarah", "role": "admin", "mfaEnabled": true }
  âœ“ Checks if MFA enabled â†’ YES
  âœ“ Returns: "MFA token required"

STEP 6: Frontend Detects MFA Needed

  Backend responds with 401:
  {
    "success": false,
    "error": "MFA token required - user has MFA enabled"
  }
  
  Frontend code:
  ```javascript
  if (data.error.includes('MFA')) {
    const mfaToken = prompt('Enter your MFA code:')
    // ... retry with MFA token
  }
  ```
  
  What user sees:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Enter your MFA code:               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚ [XXXXXX________________]    â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚  [Cancel]  [OK]                     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 7: User Enters MFA Code

  User gets OTP from authenticator app:
  âœ“ Opens Google Authenticator/Authy
  âœ“ Finds "Hospital Management System"
  âœ“ Sees 6-digit code: 123456
  âœ“ Enters in modal

STEP 8: Frontend Retries with MFA Token

  JavaScript retries:
  ```javascript
  const retryResponse = await fetch('/api/files/decrypt', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({
      fileId: 'sample.txt',
      mfaToken: '123456'
    })
  })
  ```

STEP 9: Backend + Encryption Service

  Backend receives MFA token:
  âœ“ Calls encryption service
  âœ“ Calls IAM: verify MFA with token
  âœ“ IAM checks TOTP: Valid! âœ“
  âœ“ Gets user permissions
  âœ“ Calls KMS to get DEK (Data Encryption Key)
  âœ“ Decrypts file using AES-256-GCM
  âœ“ Creates temp file
  âœ“ Schedules auto-delete (5 min)

STEP 10: Backend Returns Decrypted Content

  Response from backend:
  {
    "success": true,
    "fileId": "sample.txt",
    "content": "Hello Harini! This is a full integration test.",
    "user": {
      "id": "1",
      "name": "Dr. Sarah Admin",
      "role": "admin"
    },
    "decryptedAt": "2025-11-28T10:30:00Z",
    "autoDeleteIn": "5 minutes"
  }

STEP 11: Frontend Displays Content

  Modal updates:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Decrypted File: sample.txt                         â”‚
  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
  â”‚                                                     â”‚
  â”‚  File: sample.txt                                   â”‚
  â”‚  Encryption: AES-256-GCM                            â”‚
  â”‚  Decrypted by: Dr. Sarah Admin                      â”‚
  â”‚  Decrypted at: 2025-11-28 10:30:00                 â”‚
  â”‚                                                     â”‚
  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
  â”‚  Content:                                           â”‚
  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
  â”‚                                                     â”‚
  â”‚  Hello Harini! This is a full integration test.    â”‚
  â”‚                                                     â”‚
  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
  â”‚  Auto-deletes in: 5 minutes                        â”‚
  â”‚                                                     â”‚
  â”‚  [Copy] [Download] [Close]                         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TERMINAL OUTPUT (What You'll See in Console)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

BACKEND TERMINAL (port 3000):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

$ npm start

> hospital-backend@1.0.0 start
> node src/index.js

âœ“ Hospital Backend listening on http://localhost:3000
  Environment: development
  Database: localhost:5432/hospital_db

[Request arrives]
POST /api/files/decrypt - From: 127.0.0.1

[JWT validated]
âœ“ JWT authenticated

[Calls encryption service]
Calling encryptionService.decryptFileWithIAM()

[Encryption service logs]
[DECRYPT] Decrypting file for authorized user: 1 (Dr. Sarah Admin)
[Storage] File paths:
  Encrypted: storage/encrypted/sample.txt.enc
  Metadata: storage/metadata/sample.txt.meta.json
  Temp: storage/temp/sample.txt.temp

[KMS logs]
KMS: Getting DEK for file: sample.txt
KMS: Found DEK (32 bytes)

[Encryption logs]
[AES-256-GCM] Decrypting...
[AES-256-GCM] IV: a7f3b9c2e1d4f6a8...
[AES-256-GCM] Decryption successful
[AES-256-GCM] Plaintext size: 47 bytes

[Temp file created]
âœ“ Temporary file created: storage/temp/sample.txt.temp

[Cleanup scheduled]
â° Auto-delete scheduled in 5 minutes

[Audit log]
[AUDIT] DECRYPT_SUCCESS user=1 file=sample.txt timestamp=2025-11-28T10:30:00Z

[Response sent]
âœ“ Response: 200 OK
Response body: {
  "success": true,
  "fileId": "sample.txt",
  "content": "Hello Harini! This is a full integration test.",
  "user": { "id": "1", "name": "Dr. Sarah Admin", "role": "admin" },
  "decryptedAt": "2025-11-28T10:30:00Z",
  "autoDeleteIn": "5 minutes"
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”


IAM SERVICE TERMINAL (port 4000):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

$ node index.js

Backend listening on http://localhost:4000

[IAM request received]
GET /api/me
Header: Authorization: Bearer eyJhbGciOiJIUzI1NiIs...

[JWT verification]
âœ“ JWT is valid
âœ“ User ID: 1
âœ“ Token expires in: 14m 32s

[User lookup]
User found: Dr. Sarah Admin
Role: admin
MFA Enabled: true
Permissions: canViewPatients, canEditPatients, canDeletePatients, ...

[MFA check]
âš  MFA is enabled for this user
âœ“ Returning: mfaEnabled: true

Response: 200 OK
{
  "id": "1",
  "name": "Dr. Sarah Admin",
  "email": "admin@hospital.com",
  "role": "admin",
  "mfaEnabled": true,
  "permissions": ["canViewPatients", "canEditPatients", ...]
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[MFA verification request]
POST /api/mfa/verify
Body: { "userId": "1", "mfaToken": "123456" }

[TOTP verification]
âœ“ User secret found: JBSWY3DPEHPK3PXP
âœ“ Generating TOTP code for current time window
âœ“ Generated code: 123456
âœ“ User provided: 123456
âœ“ MATCH! âœ“

[Rate limiting check]
âœ“ User has not exceeded MFA attempts

Response: 200 OK
{
  "success": true,
  "message": "MFA verified successfully",
  "verified": true
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”


FRONTEND TERMINAL (port 5173):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

$ npm run dev

> hospital-portal-demo@1.0.0 dev
> vite

  VITE v5.4.21  ready in 450 ms

  âœ  Local:   http://localhost:5173/
  âœ  Network: use --host to expose

[User navigates to File Encryption]
âœ“ Component mounted
âœ“ Files loaded from state
âœ“ User permissions checked: canDownloadFiles = true

[User clicks Decrypt]
[Console] Decryption initiated for: sample.txt
[Console] JWT token found: eyJhbGciOiJIUzI1NiIs...

[First API call]
[Console] Sending request to /api/files/decrypt
[Console] Request body: { fileId: 'sample.txt' }

[Response received - MFA required]
[Console] Response status: 401
[Console] Error: "MFA token required - user has MFA enabled"

[MFA prompt shown]
[Console] MFA prompt displayed to user

[User enters MFA]
[Console] User entered MFA code: 123456

[Second API call - with MFA]
[Console] Retrying with MFA token: 123456

[Success response]
[Console] Decryption successful!
[Console] Content received: "Hello Harini! This is a full integration test."
[Console] Updating modal with decrypted content

[Modal displayed]
[Console] Modal state updated
[Console] Content rendered
[Console] Auto-delete timer set to 5 minutes


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ERROR SCENARIOS - What You'll See
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SCENARIO 1: Wrong MFA Code
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

User enters: 000000 (wrong code)

IAM Terminal:
  [TOTP verification]
  âœ“ User secret found: JBSWY3DPEHPK3PXP
  âœ“ Expected code: 123456
  âœ“ User provided: 000000
  âœ— NO MATCH! 

  Response: 401
  {
    "success": false,
    "error": "Invalid MFA code"
  }

Frontend Modal:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ âŒ Decryption Failed             â”‚
  â”‚                                 â”‚
  â”‚ Error: Invalid MFA code          â”‚
  â”‚                                 â”‚
  â”‚ [Try Again] [Close]             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Browser Console:
  âŒ Error: Invalid MFA token - MFA verification failed


SCENARIO 2: User Without Permission
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

User: receptionist@hospital.com (no canViewPatients permission)

Backend Terminal:
  [User permission check]
  âœ— User lacks required permissions
  âœ— Required: canViewPatients, canViewRecords, or canManageUsers
  âœ— User has: canManageAppointments only

  Response: 403 Forbidden
  {
    "success": false,
    "error": "User does not have permission to decrypt files"
  }

Frontend Modal:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ âŒ Access Denied                 â”‚
  â”‚                                 â”‚
  â”‚ You do not have permission to    â”‚
  â”‚ decrypt files. Contact admin.    â”‚
  â”‚                                 â”‚
  â”‚ [Close]                         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


SCENARIO 3: Invalid JWT Token
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Token expired or tampered

Backend Terminal:
  POST /api/files/decrypt
  
  [JWT validation]
  âœ— JWT validation failed
  âœ— Token expired
  
  authenticate middleware:
  âœ— Missing or invalid authorization header
  âœ— Rejecting request
  
  Response: 401 Unauthorized
  {
    "success": false,
    "error": "Invalid JWT token - IAM verification failed"
  }

Frontend:
  [Console] Not authenticated - please log in
  Modal shows: "Authentication failed. Please login again."

User sees prompt to re-login


SCENARIO 4: File Not Found
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Encrypted file missing from storage

Backend Terminal:
  [DECRYPT] File paths:
    Encrypted: storage/encrypted/missing.txt.enc
    Metadata: storage/metadata/missing.txt.meta.json
  
  âœ— File access check
  âœ— File not found: storage/encrypted/missing.txt.enc
  
  Response: 500 Internal Server Error
  {
    "success": false,
    "error": "File not found: missing.txt"
  }

Frontend Modal:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ âŒ Decryption Failed             â”‚
  â”‚                                 â”‚
  â”‚ Error: File not found            â”‚
  â”‚                                 â”‚
  â”‚ [Close]                         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
COMPLETE TIMING EXAMPLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Timeline:

T=0ms      â†’ User clicks [Decrypt] button
            Frontend: Shows loading spinner in modal

T=50ms     â†’ Frontend sends request to Backend
            Frontend: "Connecting to API..."

T=100ms    â†’ Backend receives request at /api/files/decrypt
            Backend Terminal:
            POST /api/files/decrypt - From: 127.0.0.1
            âœ“ JWT authenticated
            Calling encryptionService.decryptFileWithIAM()

T=150ms    â†’ Encryption service calls IAM
            Backend Terminal:
            [Calling IAM service at localhost:4000]

T=200ms    â†’ IAM verifies JWT
            IAM Terminal:
            GET /api/me
            âœ“ User verified: Dr. Sarah Admin
            âœ“ MFA Enabled: true
            Response: mfaEnabled: true

T=250ms    â†’ Backend gets MFA requirement
            Backend Terminal:
            âœ“ User has MFA enabled
            Requesting MFA token from client

T=300ms    â†’ Backend responds to Frontend
            Response: 401, "MFA token required"

T=350ms    â†’ Frontend shows MFA prompt
            Frontend: Modal shows input field
            Browser: Prompt appears

T=500ms    â†’ User enters MFA code: 123456
            User types code and clicks OK

T=550ms    â†’ Frontend retries with MFA token
            Frontend sends: { fileId: "sample.txt", mfaToken: "123456" }

T=600ms    â†’ Backend receives MFA token
            Backend Terminal:
            Retrying with MFA verification

T=650ms    â†’ Backend calls IAM to verify MFA
            IAM Terminal:
            POST /api/mfa/verify
            Body: { userId: "1", mfaToken: "123456" }
            âœ“ TOTP verification successful

T=700ms    â†’ IAM responds MFA verified
            IAM Terminal:
            Response: { success: true, verified: true }

T=750ms    â†’ Backend gets DEK from KMS
            Backend Terminal:
            KMS: Getting DEK for file: sample.txt
            âœ“ Found DEK (32 bytes)

T=800ms    â†’ Backend decrypts file
            Backend Terminal:
            [AES-256-GCM] Decrypting...
            âœ“ Decryption successful (47 bytes)

T=850ms    â†’ Backend creates temp file
            Backend Terminal:
            âœ“ Temporary file created
            â° Auto-delete scheduled in 5 minutes

T=900ms    â†’ Backend sends response to Frontend
            Response: 200 OK with decrypted content

T=950ms    â†’ Frontend receives content
            Frontend: Modal displays decrypted text
            Frontend Terminal:
            [Console] Decryption successful!
            [Console] Content: "Hello Harini!..."

T=1000ms   â†’ User sees decrypted content
            Browser: Modal shows full content with [Copy], [Download], [Close]


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SUMMARY: What Gets Output Where
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

BROWSER (Frontend):
  âœ“ Modal with loading spinner
  âœ“ MFA prompt (if MFA enabled)
  âœ“ Decrypted content displayed
  âœ“ Error messages if anything fails
  âœ“ Browser console logs (press F12)

BACKEND TERMINAL:
  âœ“ Request received logs
  âœ“ JWT validation logs
  âœ“ Encryption service logs
  âœ“ KMS logs
  âœ“ Audit logs
  âœ“ Response status
  âœ“ Any errors

IAM SERVICE TERMINAL:
  âœ“ User verification logs
  âœ“ JWT validation logs
  âœ“ MFA verification logs
  âœ“ TOTP code matching logs
  âœ“ Permissions check logs
  âœ“ Response status
  âœ“ Any errors

FRONTEND TERMINAL:
  âœ“ Vite dev server logs
  âœ“ API request logs
  âœ“ Component lifecycle logs
  âœ“ Any React errors
  âœ“ Browser console output

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
